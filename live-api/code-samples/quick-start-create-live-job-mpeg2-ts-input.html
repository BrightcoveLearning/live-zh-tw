---
title: '快速開始：為 MPEG2-TS 輸入建立即時工作'
parent: Code Samples 
grandparent: Live API
---
 <h1>此頁面已移動-您將在 3 秒內被引導至<a href="https://apis.support.brightcove.com/live-api/code-samples/quick-start-create-live-job-mpeg2-ts-input.html">新位置</a>。請更新您的書籤！</h1>
<script type="text/javascript">
var t = setTimeout(function() { window.location.href = 'https://apis.support.brightcove.com/live-api/code-samples/quick-start-create-live-job-mpeg2-ts-input.html'; } , 3000);
</script>
<article class="bcls-article">
  <h1>快速開始：為 MPEG2-TS 輸入創建實時作業</h1>
  <summary>本教程將引導您創建一個接受MPEG2-TS輸入的實時作業。作業是使用Live API創建的。</summary>



<section class="bcls-section">
<h2 id="Overview">概述</h2>

<figure class="bcls-figure"><img alt="general-block-diagram" src="/assets/images/live-api/18727/block-diagram-small.png" />框圖</figure>

<p>本教程在API級別說明瞭如何在中創建實時流作業<a href="/">Brightcove直播</a>將接受MPEG2-TS輸入。使用MPEG2-TS輸入的關鍵是選擇一個<code translate="No">protocol</code>支持MPEG2-TS，並且您的編碼器可以提供。Live API支持的支持TS的協議為：</p>

<ul>
	<li><code translate="No">rtp</code></li>
	<li><code translate="No">rtp-fec</code></li>
	<li><code translate="No">srt</code></li>
</ul>

<p>必須明確指定其中一種協議以使用TS輸入，因為默認輸入協議為<code translate="No">rtmp</code>。</p>

<p>若要將SMPTE時間碼用於剪輯，SSAI提示點或ID3標籤，應將它們插入SEI圖片定時消息中的H.264（AVC）視頻中。</p>

<p>請記住，這些協議使用UDP（用戶數據報協議）而不是TCP進行編碼器和Live之間的通信，因此需要正確配置防火牆/路由器，並允許UDP從編碼器的IP輸出到Internet。</p>

<aside class="bcls-aside bcls-aside--information">請注意，如果您在本地網絡上有開放端口，Brightcove 會為每個 SRT 和 RTP 作業動態分配端口，範圍從 10000 到 65535。</aside>

<p>如果您正在使用<code translate="No">rtp-fec</code>，FEC信息在與媒體不同的端口上發送，因此，例如，如果您使用端口2000，則還需要打開端口2002和2004（如果使用2D FEC）。</p>

<p>本教程將使用<a translate="No" href="https://general.support.brightcove.com/developer/concepts-set-curl.html">捲曲</a>發出 API 請求，但您可以輕鬆地在<a translate="No" href="https://apis.support.brightcove.com/general/use-insomnia-api-requests.html">失眠</a> , <a translate="No" href="https://apis.support.brightcove.com/general/use-postman-api-requests.html">郵差</a>或其他 REST 客戶端。</p>
</section>

<section class="bcls-section">
<h2 id="create_a_live_job">創建現場工作</h2>

<p>首先，我們將創建一個現場工作。您將需要一個<code translate="No">API-KEY</code>實時API。如果您不這樣做，並且對獲得訪問權限感興趣，請與您的客戶經理聯繫。</p>

<ol class="bcls-tasklist-restart">
	<li>
	<p>複製並粘貼以下內容<span translate="No">捲曲</span>命令進入文本編輯器：</p>

	<pre class="line-numbers">
  <code class="language-bash" translate="No">curl -X POST \
    https://api.bcovlive.io/v1/jobs \
    -H 'Content-Type: application/json' \
    -H 'x-api-key: <span class="bcls-input">{{bcov-live-api-key}}</span>' \
    -d '{
      "live_stream": true,
      "region": "<span class="bcls-input">{{closest_aws_region}}</span>",
      "protocol": "<span class="bcls-input">{{your_protocol}}</span>",
      "cidr_whitelist": ["<span class="bcls-input">{{your_encoder_IPrange}}</span>", "<span class="bcls-input">{{your_backup_encoder_IPrange}}</span>"],
      "outputs": [{
          "label": "hls360p",
          "live_stream": true,
          "height": 360,
          "video_bitrate": 365,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls432p",
          "live_stream": true,
          "height": 432,
          "video_bitrate": 730,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls540p",
          "live_stream": true,
          "height": 540,
          "video_bitrate": 2000,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls720p3M",
          "live_stream": true,
          "height": 540,
          "video_bitrate": 2000,
          "segment_seconds": 6,
          "keyframe_interval": 60
     },
     {
          "label": "hls720p4.5M",
          "live_stream": true,
          "height": 720,
          "video_bitrate": 4500,
          "segment_seconds": 6,
          "keyframe_interval": 60
     }]
  }'</code></pre>
	</li>
	<li>
	<p><strong>進行以下替換：</strong></p>

	<ul>
		<li><code translate="No">{{bcov-live-api-key}}</code>使用您的Brightcove實時API密鑰。例如：<code translate="No">abcdfeg-this-is-a-fake-api-key-FgJajjasd12hJHsZ</code></li>
		<li><code translate="No">{{closest_aws_region}}</code>距離編碼器最近的可用區域，請參見<a href="/live-api/getting-started/overview-brightcove-live-api.html#Support_aws_regions">最近可用區域</a>到您的編碼器。例如：<code translate="No">us-west-2</code></li>
		<li><code translate="No">{{your_protocol}}</code>使用輸入協議，您的編碼器將提供：<code translate="No">rpt</code>，<code translate="No">rtp-fec</code>， 或者<code translate="No">srt</code></li>
		<li><code translate="No">{{your_encoder_IPrange}}</code>編碼器將使用的IP範圍，格式為<code translate="No">1.2.3.4/32</code></li>
		<li><code translate="No">{{your_backup_encoder_IPrange}}</code>（如果有）與您的備用編碼器將使用的IP範圍，格式為<code translate="No">1.2.3.4/32</code></li>
	</ul>
	</li>
	<li>進行了這些更改之後，將代碼複製並粘貼到Terminal或您使用的任何命令行應用程序中，然後運行它。</li>
	<li>
	<p>如果您使用的是<code translate="No">rtp-fec</code>協議：</p>

	<pre class="line-numbers">
  <code class="language-json" translate="No">{
      "id": "42c913e5373844a99a6285367f2704ec",
      "outputs": [... removed for simplicity ...],
      "stream_url": "<span class="bcls-highlight">rtp:</span>//ec2-34-212-0-224.us-west-2.compute.amazonaws.com:12675",
      "stream_name": "42c913e5373844a99a6285367f2704ec.stream",
      "static": false,
      "encryption": {},
      "playback_url": "https://bcovlive-a.akamaihd.net/42c913e5373844a99a6285367f2704ec/us-west-2/NA/playlist.m3u8",
      "playback_url_dvr": "https://bcovlive-a.akamaihd.net/42c913e5373844a99a6285367f2704ec/us-west-2/NA/playlist_dvr.m3u8"
  }</code></pre>

	<p>或者像這樣<code translate="No">srt</code>：</p>

	<pre class="line-numbers">
  <code class="language-json" translate="No">{
      "id": "cdb820f2d7764b91a79536dac799fb77",
      "outputs": [... removed for simplicity ...],
      "stream_url": "srt://ec2-34-212-0-224.us-west-2.compute.amazonaws.com:13820",
      "stream_name": "cdb820f2d7764b91a79536dac799fb77.stream",
      "static": false,
      "encryption": {},
      "playback_url": "https://bcovlive-a.akamaihd.net/cdb820f2d7764b91a79536dac799fb77/us-west-2/NA/playlist.m3u8",
      "playback_url_dvr": "https://bcovlive-a.akamaihd.net/cdb820f2d7764b91a79536dac799fb77/us-west-2/NA/playlist_dvr.m3u8"
  }</code></pre>
	</li>
</ol>

<aside class="bcls-aside bcls-aside--information">請注意，SRT 流的端口（上例中的 13820）對於每個作業都是唯一的，您需要從作業創建請求的響應中獲取它！</aside>

<p>此工作將創建5個演繹版本<strong>基於</strong>上<a href="https://developer.apple.com/documentation/http_live_streaming/hls_authoring_specification_for_apple_devices">蘋果推薦</a>。</p>
</section>

<section class="bcls-section">
<h2 id="Configure_your_encoder_ts">配置編碼器（TS + FEC）</h2>

<p>此處顯示的步驟將假定<a href="https://www.elemental.com/products/aws-elemental-live">元素直播盒</a>編碼器，用於測試本教程的步驟。如果您使用其他編碼器，則設置應相似。</p>

<p>最重要的設置<code translate="No">rtp-fec</code>輸入是：</p>

<ul>
	<li>將時間碼源配置為“系統時鐘"</li>
	<li>將“前向糾錯"設置為“列和行"，並設置“列深度"和“行長度"值：
	<ul>
		<li><strong>庫倫深度：</strong>4（每個“列深度" TS數據包將添加1個額外的FEC數據包）</li>
		<li><strong>行長：</strong>10（每個“行長" TS數據包將添加1個額外的FEC數據包）</li>
		<li>可以計算添加的其他數據：TotalBitrate = MediaBitrate *（1 /（列深度+ 1）+ 1 /（行長度+ 1）</li>
	</ul>
	</li>
	<li>檢查視頻中的“時間碼插入"</li>
	<li>強烈推薦：幀率=跟隨來源</li>
</ul>

<p>這是我們用於此TS + FEC示例的配置：</p>

<figure class="bcls-figure"><img alt="elemental-live-job-config" title="Elemental live config" src="/assets/images/live-api/18727/elemental-live-job-config-fec-v1a.png" />
<figcaption class="bcls-caption--image">元素實時配置</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="Configure_your_encoder_srt">配置編碼器（SRT）</h2>

<p>此處顯示的設置基於<a href="https://www.haivision.com/products/kb-series/">海威視KB</a>編碼器，用於測試本教程的步驟。如果您使用其他編碼器，則設置應相似。</p>

<p>這是我們用於此SRT示例的配置：</p>

<figure class="bcls-figure"><img alt="Haivision-live-job-config" title="Haivision live config" src="/assets/images/live-api/18727/haivision-kb-srt-config.png" />
<figcaption class="bcls-caption--image">Haivision實時配置</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="test_playback">測試播放</h2>

<p>你可以用這個<a href="https://videojs.github.io/videojs-contrib-hls/">VideoJS HLS演示頁</a>要測試播放，只需粘貼值<code translate="No">playback_url</code>在創建作業響應中返回：</p>

<figure class="bcls-figure"><img alt="videojs-hls-playback" title="VideoJS HLS playback demo page" src="/assets/images/live-api/18727/videojs-hls-playback-small.png" />
<figcaption class="bcls-caption--image">VideoJS HLS播放演示頁面</figcaption>
</figure>
</section>
</article>